<VirtualHost *:80>
    ServerName		drupal.example.com

    ServerName 		drupal.example.com
#    ServerAlias example.com *.example.com
    DocumentRoot 	/var/www/drupal.ka8zrt.com/web

    ErrorLog		"logs/www-error.log"
    CustomLog		"logs/www-access.log" combined	

    RewriteEngine	On
    RewriteRule 	^/(.*) https://%{HTTP_HOST}/$1
    LogLevel		rewrite:trace8
</VirtualHost>

<VirtualHost *:443>
    ServerAdmin user@example.com
	      
    ServerName 		drupal.example.com
#    ServerAlias example.com *.example.com
    DocumentRoot 	/var/www/drupal.example.com/web

    ErrorLog		"logs/drupal-ssl-error.log"
    CustomLog		"logs/drupal-ssl-access.log" combined	

    RewriteEngine 	On
    RewriteOptions 	inherit

    # SSL settings common to all virtual hosts, including protocol and 
    # cipher suite.
    Include /etc/letsencrypt/options-ssl-apache.conf

    # Server Certificate:
    # Point SSLCertificateFile at a PEM encoded certificate.  If
    # the certificate is encrypted, then you will be prompted for a
    # pass phrase.  Note that a kill -HUP will prompt again.  A new
    # certificate can be generated using the genkey(1) command.
    SSLCertificateFile /etc/letsencrypt/live/drupal.example.com/cert.pem

    # Server Private Key:
    # If the key is not combined with the certificate, use this
    # directive to point at the key file.  Keep in mind that if
    # you've both a RSA and a DSA private key you can configure
    # both in parallel (to also allow the use of DSA ciphers, etc.)
    SSLCertificateKeyFile /etc/letsencrypt/live/drupal.example.com/privkey.pem

    # Server Certificate Chain:
    # Point SSLCertificateChainFile at a file containing the
    # concatenation of PEM encoded CA certificates which form the
    # certificate chain for the server certificate. Alternatively
    # the referenced file can be the same as SSLCertificateFile
    # when the CA certificates are directly appended to the server
    # certificate for convinience.
    SSLCertificateChainFile /etc/letsencrypt/live/drupal.example.com/chain.pem

    # Certificate Authority (CA):
    # Set the CA certificate verification path where to find CA
    # certificates for client authentication or alternatively one
    # huge file containing all of them (file must be PEM encoded)
    #
    # Required for the CAcert personal client certificates
    SSLCACertificateFile /etc/pki/tls/certs/ca-bundle.crt

    # SSL Specific options
#    SSLEngine on
#    SSLCipherSuite ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP:+eNULL
#    SetEnvIf User-Agent ".*MSIE.*" nokeepalive ssl-unclean-shutdown

    <Files ~ "\.(cgi|shtml|phtml|php3?)$">
        SSLOptions +StdEnvVars
    </Files>

    <Directory "/var/www/cgi-bin">
        SSLOptions +StdEnvVars
    </Directory>

    BrowserMatch "MSIE [2-5]" \
         nokeepalive ssl-unclean-shutdown \
         downgrade-1.0 force-response-1.0

    <Directory /var/www/drupal.example.com>
        Options Indexes MultiViews FollowSymLinks
        AllowOverride All

        RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME} !-f
	RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME} !-d
	RewriteRule ^(.*)$ /index.php?q=$1 [L,QSA]
    </Directory>


	      
</VirtualHost>
